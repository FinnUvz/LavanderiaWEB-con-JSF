<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Gestión de Clientes</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    
    <style>
        .ui-datatable .ui-selection-column {
            width: 40px;
            text-align: center;
        }
        .actions-column {
            width: 150px;
            text-align: center;
        }
        .ui-datatable .ui-state-highlight {
            background-color: #e9f7fe !important;
            color: #333 !important;
        }
        .ui-datatable .ui-state-highlight a {
            color: #333 !important;
        }
    </style>
</h:head>

<h:body>
    <div class="container-fluid mt-3">
        <h:form id="form">
            <p:growl id="messages" showDetail="true"/>
            
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="mb-0">Gestión de Clientes</h3>
                        <p:commandButton value="Nuevo Cliente" icon="pi pi-plus" 
                                       styleClass="btn btn-light"
                                       action="#{gestionClientesBean.prepararNuevoCliente}"
                                       update=":form:pnlCliente"
                                       oncomplete="PF('dlgCliente').show()"/>
                    </div>
                </div>
                
                <div class="card-body">
                    <p:dataTable id="dtClientes" value="#{gestionClientesBean.listaClientes}" var="cliente"
                               paginator="true" rows="10" paginatorPosition="bottom"
                               selection="#{gestionClientesBean.clientesSeleccionados}"
                               rowKey="#{cliente.idUsuario}"
                               styleClass="table table-striped"
                               emptyMessage="No se encontraron clientes">
                        
                        <p:column selectionMode="multiple" styleClass="ui-selection-column"/>
                        
                        <p:column headerText="ID" sortBy="#{cliente.idUsuario}" style="width:80px">
                            <h:outputText value="#{cliente.idUsuario}"/>
                        </p:column>
                        
                        <p:column headerText="Nombre" sortBy="#{cliente.nombre}" filterBy="#{cliente.nombre}">
                            <h:outputText value="#{cliente.nombre}"/>
                        </p:column>
                        
                        <p:column headerText="Correo" sortBy="#{cliente.correo}" filterBy="#{cliente.correo}">
                            <h:outputText value="#{cliente.correo}"/>
                        </p:column>
                        
                        <p:column headerText="Teléfono" sortBy="#{cliente.telefono}">
                            <h:outputText value="#{cliente.telefono}"/>
                        </p:column>
                        
                        <p:column headerText="Acciones" styleClass="actions-column">
                            <p:commandButton icon="pi pi-pencil" styleClass="btn btn-sm btn-warning me-1"
                                           action="#{gestionClientesBean.prepararEdicionCliente(cliente)}"
                                           update=":form:pnlCliente"
                                           oncomplete="PF('dlgCliente').show()"/>
                            
                            <p:commandButton icon="pi pi-trash" styleClass="btn btn-sm btn-danger"
                                           action="#{gestionClientesBean.prepararEliminacionCliente(cliente)}"
                                           update=":form:dlgConfirmar"/>
                        </p:column>
                    </p:dataTable>
                </div>
                
                <div class="card-footer text-end">
                    <p:commandButton value="Eliminar seleccionados" icon="pi pi-trash"
                                   styleClass="btn btn-danger"
                                   disabled="#{empty gestionClientesBean.clientesSeleccionados}"
                                   action="#{gestionClientesBean.eliminarClientesSeleccionados}"
                                   update=":form:messages, :form:dtClientes">
                        <p:confirm header="Confirmar eliminación" 
                                 message="¿Está seguro de eliminar los clientes seleccionados?" 
                                 icon="pi pi-exclamation-triangle"/>
                    </p:commandButton>
                </div>
            </div>
            
            <!-- Diálogo para confirmar eliminación -->
            <p:confirmDialog id="dlgConfirmar" widgetVar="dlgConfirmar" 
                            header="Confirmar eliminación"
                            message="¿Está seguro de eliminar este cliente?"
                            severity="alert">
                <p:commandButton value="Sí" type="button" styleClass="btn btn-danger"
                               action="#{gestionClientesBean.eliminarCliente}"
                               oncomplete="PF('dlgConfirmar').hide()"
                               update=":form:messages, :form:dtClientes"/>
                <p:commandButton value="No" type="button" styleClass="btn btn-secondary"
                               onclick="PF('dlgConfirmar').hide()"/>
            </p:confirmDialog>
            
            <!-- Diálogo para agregar/editar cliente -->
            <p:dialog id="dlgCliente" widgetVar="dlgCliente" header="Gestión de Cliente" 
                     modal="true" resizable="false" styleClass="modal-dialog" 
                     closeOnEscape="true" width="600px">
                <p:outputPanel id="pnlCliente" styleClass="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">
                            #{gestionClientesBean.clienteSeleccionado.idUsuario == 0 ? 'Nuevo Cliente' : 'Editar Cliente'}
                        </h5>
                        <button type="button" class="btn-close" onclick="PF('dlgCliente').hide()" 
                               aria-label="Close"></button>
                    </div>
                    
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre completo</label>
                            <p:inputText id="nombre" value="#{gestionClientesBean.clienteSeleccionado.nombre}" 
                                       styleClass="form-control" required="true" 
                                       requiredMessage="El nombre es obligatorio"/>
                            <p:message for="nombre" display="text" styleClass="text-danger"/>
                        </div>
                        
                        <div class="mb-3">
                            <label for="correo" class="form-label">Correo electrónico</label>
                            <p:inputText id="correo" value="#{gestionClientesBean.clienteSeleccionado.correo}" 
                                       styleClass="form-control" required="true"
                                       requiredMessage="El correo es obligatorio"
                                       disabled="#{gestionClientesBean.clienteSeleccionado.idUsuario != 0}"/>
                            <p:message for="correo" display="text" styleClass="text-danger"/>
                        </div>
                        
                        <div class="mb-3">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <p:inputText id="telefono" value="#{gestionClientesBean.clienteSeleccionado.telefono}" 
                                       styleClass="form-control"/>
                        </div>
                        
                        <div class="mb-3">
                            <label for="direccion" class="form-label">Dirección</label>
                            <p:inputTextarea id="direccion" value="#{gestionClientesBean.clienteSeleccionado.direccion}" 
                                           styleClass="form-control" rows="3"/>
                        </div>
                        
                        <h:panelGroup rendered="#{gestionClientesBean.clienteSeleccionado.idUsuario == 0}">
                            <div class="mb-3">
                                <label for="contrasena" class="form-label">Contraseña</label>
                                <p:password id="contrasena" value="#{gestionClientesBean.clienteSeleccionado.contrasena}" 
                                           styleClass="form-control" required="true"
                                           requiredMessage="La contraseña es obligatoria"
                                           feedback="false"/>
                                <p:message for="contrasena" display="text" styleClass="text-danger"/>
                            </div>
                        </h:panelGroup>
                    </div>
                    
                    <div class="modal-footer">
                        <p:commandButton value="Cancelar" styleClass="btn btn-secondary"
                                       onclick="PF('dlgCliente').hide()"/>
                        
                        <p:commandButton value="Guardar" styleClass="btn btn-primary"
                                       action="#{gestionClientesBean.guardarCliente}"
                                       update=":form:messages, :form:dtClientes"
                                       process="@form"
                                       oncomplete="if(!args.validationFailed) PF('dlgCliente').hide()"/>
                    </div>
                </p:outputPanel>
            </p:dialog>
        </h:form>
    </div>
    
    <!-- Bootstrap JS Bundle con Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</h:body>
</html>